<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta this_name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta this_name="this_description" content=""/>
    <meta this_name="author" content=""/>
    <title>Training API - Controls</title>
    <link href="/config/style.css" rel="stylesheet"/>
    <link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet"
          crossorigin="anonymous"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/js/all.min.js"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>
</head>
<body class="sb-nav-fixed">
<nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
    <a class="navbar-brand" href="/">API Control</a>
    <button class="btn btn-link btn-sm order-1 order-lg-0" id="sidebarToggle" href="#"><i class="fas fa-bars"></i>
    </button>
</nav>
<div id="layoutSidenav">
    <div id="layoutSidenav_nav">
        <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
            <div class="sb-sidenav-menu">
                <div class="nav">
                    <div class="sb-sidenav-menu-heading">API Controls</div>
                    <a class="nav-link" href="/config/seeding">
                        <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                        Seeding
                    </a>
                    <a class="nav-link" href="/config/doubleElim">
                        <div class="sb-nav-link-icon"><i class="fas fa-columns"></i></div>
                        Double Elimination
                    </a>
                </div>
            </div>
        </nav>
    </div>
    <div id="layoutSidenav_content">
        <main>
            <div class="container-fluid">
                <div class="row">
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-lg-10">
                                <div class="card shadow-lg border-0 rounded-lg mt-3">
                                    <div class="card-header"><h3 class="text-center font-weight-light my-4">Game
                                        Info</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="alert alert-info" role="alert" id="version">
                                            Version 0.16
                                        </div>
                                        <div class="alert alert-info" role="alert">
                                            API ip:
                                            <div id="local_ip"></div>
                                            <hr>
                                            Put this at the top of your python program for all API functions to call
                                            this computer. Important: don't change the order of those three commands!
                                            <br>
                                            <code style="color: black">
                                                import os <br>
                                                os.environ["API_URL"] = "http://<span style="white-space: nowrap;"
                                                                                      id="local_ip_0"></span>:5000/"
                                                <br>
                                                from compLib.Api import DoubleElim
                                            </code>
                                        </div>
                                        <hr>
                                        <div class="alert alert-primary" role="alert" id="is_seeding">
                                            Game state is set to seeding! Switch to double elimination below.
                                        </div>
                                        <input id="set_to_de" class="btn btn-primary" type="submit"
                                               value="Set to Double Elimination" onclick="set_to_de()"
                                               name="submit"> <br>
                                        <hr>
                                        <label for="teams1">Choose a team:</label>
                                        <select name="teams1" id="teams1" onchange="setMeta()">
                                            <option value="ROBO ur LEMLL">ROBO ur LEMLL</option>
                                            <option value="Roberarius">Roberarius</option>
                                            <option value="The T.I.M.E.">The T.I.M.E.</option>
                                            <option value="Robros">Robros</option>
                                            <option value="WWWW">WWWW</option>
                                            <option value="alias">alias</option>
                                            <option value="Ioob">Ioob</option>
                                            <option value="blank">blank</option>
                                            <option value="rc2c">rc2c</option>
                                            <option value="String_Error">String_Error</option>
                                        </select>
                                        <label for="teams2">Choose a team:</label>
                                        <select name="teams2" id="teams2" onchange="setMeta()">
                                            <option value="ROBO ur LEMLL">ROBO ur LEMLL</option>
                                            <option value="Roberarius">Roberarius</option>
                                            <option value="The T.I.M.E.">The T.I.M.E.</option>
                                            <option value="Robros">Robros</option>
                                            <option value="WWWW">WWWW</option>
                                            <option value="alias">alias</option>
                                            <option value="Ioob">Ioob</option>
                                            <option value="blank">blank</option>
                                            <option value="rc2c">rc2c</option>
                                            <option value="String_Error">String_Error</option>
                                        </select>
                                        <div class="alert alert-primary" role="alert">
                                            IP Address Team 1:
                                            <input id="ip1" value="not set" onchange="setMeta()">
                                        </div>
                                        <div class="alert alert-primary" role="alert">
                                            IP Address Team 2:
                                            <input id="ip2" value="not set" onchange="setMeta()">
                                        </div>
                                        <input id="start_button" class="btn btn-primary"
                                               style="background-color: #f44336; border-color: #f44336;" type="submit"
                                               value="Start Match" onclick="startMatch()"
                                               name="submit"> <br>
                                        <input class="btn btn-primary" type="submit" value="Submit Scores"
                                               onclick="submitScores()" disabled
                                               name="submit"> <br>
                                        <hr>
                                        <input class="btn btn-primary" type="submit" value="Reset API" onclick="reset()"
                                               name="submit"> <br>
                                        <input id="spin_btn" class="btn btn-primary" type="submit"
                                               value="You spin me right round baby right round" onclick="spin()"
                                               name="submit"> <br>

                                        <hr>

                                        <input id="robot1for" class="btn btn-primary" type="submit"
                                               value="Robot 1 forward" onclick="robot1For()"
                                               name="submit"> <br>
                                        <input id="robot1back" class="btn btn-primary" type="submit"
                                               value="Robot 1 backward" onclick="robot1Back()"
                                               name="submit"> <br>

                                        <hr>

                                        <input id="robot2for" class="btn btn-primary" type="submit"
                                               value="Robot 2 forward" onclick="robot2For()"
                                               name="submit"> <br>
                                        <input id="robot2back" class="btn btn-primary" type="submit"
                                               value="Robot 2 backward" onclick="robot2Back()"
                                               name="submit"> <br>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-5">
                                <div class="card shadow-lg border-0 rounded-lg mt-3">
                                    <div class="card-header"><h3 class="text-center font-weight-light my-4">Game
                                        Status</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="alert alert-danger" role="alert" id="gameStarted">
                                            Game has not started yet
                                        </div>
                                        <div class="alert alert-primary" role="alert">
                                            Game Time
                                            <div id="timeleft">0</div>
                                        </div>
                                        <div class="alert alert-primary" role="alert">
                                            Overtime
                                            <div id="overtime">0</div>
                                        </div>
                                        <div class="alert alert-primary" role="alert">
                                            Team 1 Game Score from api:
                                            <input type="number" id="score1">
                                            <label for="override_score1">Override</label>
                                            <input type="checkbox" id="override_score1">
                                        </div>
                                        <div class="alert alert-primary" role="alert">
                                            Team 2 Game Score from api:
                                            <input type="number" id="score2">
                                            <label for="override_score2">Override</label>
                                            <input type="checkbox" id="override_score2">
                                        </div>
                                        <div class="alert alert-primary" role="alert">
                                            Score that will be submitted:
                                            <input type="number" id="real_score" disabled="true">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-5">
                                <div class="card shadow-lg border-0 rounded-lg mt-3">
                                    <div class="card-header"><h3 class="text-center font-weight-light my-4">Robot 1</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="alert alert-primary" role="alert">
                                            Robot1 Speed Modifier:
                                            <div id="robot1_speed_limit">0</div>
                                        </div>
                                        <div class="alert alert-primary" role="alert">
                                            Robot1 Collected items:
                                            <div id="robot1_collected_items">[]</div>
                                        </div>
                                        <div class="alert alert-danger" id="robot1_is_currently_jammed">
                                            Is currently jammed
                                        </div>
                                        <div class="alert alert-danger" id="robot1_is_currently_hacked">
                                            Is currently hacked
                                        </div>
                                        <div class="alert alert-danger" id="robot1_is_affected_by_oilspill">
                                            Is affected by oilspill
                                        </div>
                                        <div class="alert alert-danger" id="robot1_has_radar">
                                            Has a radar item equipped
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-5">
                                <div class="card shadow-lg border-0 rounded-lg mt-3">
                                    <div class="card-header"><h3 class="text-center font-weight-light my-4">Robot 2</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="alert alert-primary" role="alert">
                                            Robot2 Speed Modifier:
                                            <div id="robot2_speed_limit">0</div>
                                        </div>
                                        <div class="alert alert-primary" role="alert">
                                            Robot2 Collected items:
                                            <div id="robot2_collected_items">[]</div>
                                        </div>
                                        <div class="alert alert-danger" id="robot2_is_currently_jammed">
                                            Is currently jammed
                                        </div>
                                        <div class="alert alert-danger" id="robot2_is_currently_hacked">
                                            Is currently hacked
                                        </div>
                                        <div class="alert alert-danger" id="robot2_is_affected_by_oilspill">
                                            Is affected by oilspill
                                        </div>
                                        <div class="alert alert-danger" id="robot2_has_radar">
                                            Has a radar item equipped
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <script>

                    function submitScores() {
                        console.log("submit scores is not yet ready");
                    }

                    function reset() {
                        let xmlHttp = new XMLHttpRequest();
                        xmlHttp.open("GET", "/config/resetState", false);
                        xmlHttp.send(null);
                        location.reload();
                    }

                    function spin() {
                        let xmlHttp = new XMLHttpRequest();
                        xmlHttp.open("GET", "/config/spin", false);
                        xmlHttp.send(null);
                    }

                    function startMatch() {
                        let xmlHttp = new XMLHttpRequest();
                        xmlHttp.open("GET", "/config/startMatch", false);
                        xmlHttp.send(null);
                    }

                    function set_to_de() {
                        let xmlHttp = new XMLHttpRequest();
                        xmlHttp.open("GET", "/config/setToDoubleElim", false);
                        xmlHttp.send(null);
                    }

                    function robot1For() {
                        let xmlHttp = new XMLHttpRequest();
                        xmlHttp.open("GET", "/config/robot1For", false);
                        xmlHttp.send(null);
                    }

                    function robot2For() {
                        let xmlHttp = new XMLHttpRequest();
                        xmlHttp.open("GET", "/config/robot2For", false);
                        xmlHttp.send(null);
                    }

                    function robot1Back() {
                        let xmlHttp = new XMLHttpRequest();
                        xmlHttp.open("GET", "/config/robot1Back", false);
                        xmlHttp.send(null);
                    }

                    function robot2Back() {
                        let xmlHttp = new XMLHttpRequest();
                        xmlHttp.open("GET", "/config/robot2Back", false);
                        xmlHttp.send(null);
                    }

                    function setMeta() {
                        let xmlHttp = new XMLHttpRequest();
                        xmlHttp.open("POST", "/config/setMeta", true);

                        xmlHttp.setRequestHeader("Content-Type", "text/plain");
                        xmlHttp.send(JSON.stringify({
                            "teamname1": document.getElementById("teams1").value,
                            "teamname2": document.getElementById("teams2").value,
                            "ip1": document.getElementById("ip1").value,
                            "ip2": document.getElementById("ip2").value
                        }));
                    }

                    function getInfo() {
                        let xmlHttp = new XMLHttpRequest();
                        xmlHttp.open("GET", "/config/getInfo", false);
                        xmlHttp.send(null);

                        let res = JSON.parse(xmlHttp.responseText);

                        if (res["is_seeding"] == true) {
                            return;
                        }

                        document.getElementById("local_ip").innerText = res["local_ip"];
                        document.getElementById("local_ip_0").innerText = res["local_ip"];

                        if (res["running"] == true && res["timeleft"] != 0) {
                            document.getElementById("gameStarted").className = "alert alert-success";
                            document.getElementById("gameStarted").innerText = "Game is running";
                        } else if (res["ready"] == true) {
                            document.getElementById("gameStarted").className = "alert alert-warning";
                            document.getElementById("gameStarted").innerText = "Waiting for judge to start the match";
                        } else if (res["running"] == true && res["timeleft"] == 0) {
                            document.getElementById("gameStarted").className = "alert alert-info";
                            document.getElementById("gameStarted").innerText = "Game is finished";
                        } else {
                            document.getElementById("gameStarted").className = "alert alert-danger";
                            document.getElementById("gameStarted").innerText = "Game has not started yet";
                        }

                        document.getElementById("timeleft").innerText = res["timeleft"];
                        document.getElementById("overtime").innerText = res["overtime"];
                        document.getElementById("robot1_speed_limit").innerText = res["robot1_speed_limit"];
                        document.getElementById("robot2_speed_limit").innerText = res["robot2_speed_limit"];
                        document.getElementById("robot1_collected_items").innerText = res["robot1_collected_items"];
                        document.getElementById("robot2_collected_items").innerText = res["robot2_collected_items"];

                        if (!document.getElementById("override_score1").checked) {
                            document.getElementById("score1").value = res["score1"];
                        }
                        if (!document.getElementById("override_score2").checked) {
                            document.getElementById("score2").value = res["score2"];
                        }

                        if (document.getElementById("ip1").value == "not set") {
                            document.getElementById("ip1").value = res["ip1"];
                        }
                        if (document.getElementById("ip2").value == "not set") {
                            document.getElementById("ip2").value = res["ip2"];
                        }

                        if (res["can_start"] == true) {
                            document.getElementById("start_button").style = "background-color: #4CAF50; border-color: #4CAF50;";
                        } else {
                            document.getElementById("start_button").style = "background-color: #f44336; border-color: #f44336;";
                        }

                        if (res["is_spinning"] == true) {
                            document.getElementById("spin_btn").style = "background-color: #4CAF50; border-color: #4CAF50;";
                        } else {
                            document.getElementById("spin_btn").style = "background-color: #f44336; border-color: #f44336;";
                        }

                        if (res["robot1for"] == true) {
                            document.getElementById("robot1for").style = "background-color: #4CAF50; border-color: #4CAF50;";
                        } else {
                            document.getElementById("robot1for").style = "background-color: #f44336; border-color: #f44336;";
                        }

                        if (res["robot2for"] == true) {
                            document.getElementById("robot2for").style = "background-color: #4CAF50; border-color: #4CAF50;";
                        } else {
                            document.getElementById("robot2for").style = "background-color: #f44336; border-color: #f44336;";
                        }

                        if (res["robot1back"] == true) {
                            document.getElementById("robot1back").style = "background-color: #4CAF50; border-color: #4CAF50;";
                        } else {
                            document.getElementById("robot1back").style = "background-color: #f44336; border-color: #f44336;";
                        }

                        if (res["robot2back"] == true) {
                            document.getElementById("robot2back").style = "background-color: #4CAF50; border-color: #4CAF50;";
                        } else {
                            document.getElementById("robot2back").style = "background-color: #f44336; border-color: #f44336;";
                        }

                        if (res["is_seeding"] == true) {
                            document.getElementById("is_seeding").innerText = "Game state is set to seeding! Switch to double elimination below.";
                            document.getElementById("is_seeding").style = "background-color: #f44336; border-color: #f44336;";
                        } else {
                            document.getElementById("is_seeding").innerText = "Gamestate is set to double elimination";
                            document.getElementById("is_seeding").style = "background-color: #4CAF50; border-color: #4CAF50;";
                        }

                        if (res["robot1_is_currently_jammed"] == true) {
                            document.getElementById("robot1_is_currently_jammed").className = "alert alert-success";
                        } else {
                            document.getElementById("robot1_is_currently_jammed").className = "alert alert-danger";
                        }

                        if (res["robot2_is_currently_jammed"] == true) {
                            document.getElementById("robot2_is_currently_jammed").className = "alert alert-success";
                        } else {
                            document.getElementById("robot2_is_currently_jammed").className = "alert alert-danger";
                        }

                        if (res["robot1_is_currently_hacked"] == true) {
                            document.getElementById("robot1_is_currently_hacked").className = "alert alert-success";
                        } else {
                            document.getElementById("robot1_is_currently_hacked").className = "alert alert-danger";
                        }

                        if (res["robot2_is_currently_hacked"] == true) {
                            document.getElementById("robot2_is_currently_hacked").className = "alert alert-success";
                        } else {
                            document.getElementById("robot2_is_currently_hacked").className = "alert alert-danger";
                        }

                        if (res["robot1_is_affected_by_oilspill"] == true) {
                            document.getElementById("robot1_is_affected_by_oilspill").className = "alert alert-success";
                        } else {
                            document.getElementById("robot1_is_affected_by_oilspill").className = "alert alert-danger";
                        }

                        if (res["robot2_is_affected_by_oilspill"] == true) {
                            document.getElementById("robot2_is_affected_by_oilspill").className = "alert alert-success";
                        } else {
                            document.getElementById("robot2_is_affected_by_oilspill").className = "alert alert-danger";
                        }

                        if (res["robot1_has_radar"] == true) {
                            document.getElementById("robot1_has_radar").className = "alert alert-success";
                        } else {
                            document.getElementById("robot1_has_radar").className = "alert alert-danger";
                        }

                        if (res["robot2_has_radar"] == true) {
                            document.getElementById("robot2_has_radar").className = "alert alert-success";
                        } else {
                            document.getElementById("robot2_has_radar").className = "alert alert-danger";
                        }
                    }

                    setInterval(getInfo, 100);
                </script>

            </div>
        </main>
        <footer class="py-4 bg-light mt-auto">
            <div class="container-fluid">
                <div class="d-flex align-items-center justify-content-between small">
                    <div class="text-muted">Copyright &copy; Verein zur Förderung von Wissenschaft und Technik an
                        Schulen (F-WuTS) 2010-2022
                    </div>
                    <div>
                        <a href="https://robo4you.at/datenschutz">Privacy Policy</a>
                        &middot;
                        <a href="https://robo4you.at/kontakt">Contact Us</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>
</div>

</body>
</html>